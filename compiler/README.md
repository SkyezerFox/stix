# Compiler

The Styx compiler is responsible for translating Styx source code into compiled Styx code (obviously). However, it's clearly not as simple as that, so I have gone into detail on how it works below.

## Usage

> Note: This is the usage specification for the compiler CLI, which does not currently exist! The Styx CLI is also referenced, which also does not currently exist!

### Run a Styx script

```sh
$ styxc hello-world.stx
# or, use the styx CLI
$ styx hello-world.stx
hello world!
```

### Compile a Styx script

```sh
$ styxc --binary hello-world.stx -o hello-world
# or, use the styx CLI
$ styx compile hello-world.stx -o hello-world
$ ./hello-world
hello world!
```

## Stages

1. Lexing - The compiler takes an input source file and generates a stream of identifiable tokens.
2. Parsing - The compiler takes tokens generated by the previous step and produces an AST.
3. Semantic analysis - The compiler descends through the AST ensuring variables are correctly typed, referenced, and declared.
4. IR generation - The compiler produces LLVM IR from the AST.
5. Code generation - The compiler produces platform and architecture specific machine code.

## Crates

- [`styxc_ast_passes`](./styxc_ast_passes) - Defines the AST parses for the pre-IR generation phase.
- [`styxc_ast`](./styxc_ast) - Contains type definitions and handles the semantic analysis of the AST.
- [`styxc_errors`](./styxc_errors) - Error handling and message reporting crate.
- [`styxc_ir`](./styxc_ir) - Handles the generation of LLVM IR using the Cranelift IR generator from the AST.
- [`styxc_main`](./styxc_main) - The compiler entrypoint and step execution logic.
- [`styxc_parser`](./styxc_parser) - Parses a `TokenStream` into an AST.
- [`styxc_span`](./styxc_span) - Defines the `Span` type used in the compiler.
- [`styxc_tests`](./styxc_tests) - Contains tests for the compiler.
- [`styxc_types`](./styxc_types) - Defines the types used in the compiler.
- [`styxc_walker`](./styxc_walker) - Defines an AST walker for performing semantic analysis.
- [`styxc`](./styxc) - The compiler CLI interface.

## Modes

The Styx compiler has two distinct modes.

-   JIT - The compiler immediately triggers execution of compiles source code as soon as it is finished. Dynamic imports are enabled, and will be compiled as soon as they are imported.
-   AOT - The compiler builds a static binary for the target system and architecture which can be run at a later date.
